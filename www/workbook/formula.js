/**
 * @license Copyright 2013 - 2014 Intel Corporation All Rights Reserved.
 *
 * The source code, information and material ("Material") contained herein is owned by Intel Corporation or its
 * suppliers or licensors, and title to such Material remains with Intel Corporation or its suppliers or
 * licensors. The Material contains proprietary information of Intel or its suppliers and licensors. The
 * Material is protected by worldwide copyright laws and treaty provisions. No part of the Material may be used,
 * copied, reproduced, modified, published, uploaded, posted, transmitted, distributed or disclosed in any way
 * without Intel's prior express written permission. No license under any patent, copyright or other intellectual
 * property rights in the Material is granted to or conferred upon you, either expressly, by implication,
 * inducement, estoppel or otherwise. Any license under such intellectual property rights must be express and
 * approved by Intel in writing.
 *
 * Unless otherwise agreed by Intel in writing, you may not remove or alter this notice or any other notice
 * embedded in Materials by Intel or Intel's suppliers or licensors in any way.
 */
goog.provide("idr.workbook.Formula"),goog.require("goog.i18n.NumberFormat"),idr.workbook.Formula=function(){},idr.workbook.Formula.GENERAL_ERROR="Error in formula",idr.workbook.Formula.ARGSTOARRAY=function(args){return Array.prototype.slice.call(args,0)},idr.workbook.Formula.ISNUMBER=function(number){return!isNaN(parseFloat(number))&&isFinite(number)?!0:!1},idr.workbook.Formula.ARGSCONCAT=function(args){for(var result=[],i=0;i<args.length;i++)result=result.concat(args[i]);return result},idr.workbook.Formula.SUM=function(){for(var numbers=idr.workbook.Formula.ARGSTOARRAY(arguments),result=0,i=0;i<numbers.length;i++)if(numbers[i]instanceof Array)for(var j=0;j<numbers[i].length;j++)result+=idr.workbook.Formula.ISNUMBER(numbers[i][j])?numbers[i][j]:0;else result+=idr.workbook.Formula.ISNUMBER(numbers[i])?numbers[i]:0;return result},idr.workbook.Formula.AVERAGE=function(){for(var range=idr.workbook.Formula.ARGSCONCAT(arguments),n=range.length,count=0,sigma=0,i=0;n>i;i++)if(range[i]!==!0&&range[i]!==!1){var currentNumber=parseFloat(range[i]);isNaN(currentNumber)||(sigma+=range[i],count++)}return 0===count?0:sigma/count},idr.workbook.Formula.COUNT=function(){return idr.workbook.Formula.ARGSCONCAT(arguments).length},idr.workbook.Formula.MAX=function(){for(var range=idr.workbook.Formula.ARGSCONCAT(arguments),n=range.length,max=n>0?range[0]:0,i=0;n>i;i++)max=range[i]>max&&range[i]!==!0&&range[i]!==!1?range[i]:max;return max},idr.workbook.Formula.MIN=function(){for(var range=idr.workbook.Formula.ARGSCONCAT(arguments),n=range.length,min=n>0?range[0]:0,i=0;n>i;i++)min=range[i]<min&&range[i]!==!0&&range[i]!==!1?range[i]:min;return min},idr.workbook.Formula.IF=function(test,then_value,otherwise_value){return test?"undefined"==typeof then_value?!0:then_value:"undefined"==typeof otherwise_value?!0:otherwise_value},idr.workbook.Formula.CONCATENATE=function(){for(var string="",i=0;i<arguments.length;i++)null!==arguments[i]&&void 0!==arguments[i]&&(string+=arguments[i]);return string},idr.workbook.Formula.ELEMENTSINRANGE=function(){for(var string="",i=0;i<arguments.length;i++)null!==arguments[i]&&void 0!==arguments[i]&&(string+=arguments[i],""!==arguments[i]&&i!==arguments.length-1&&(string+=","));return string},idr.workbook.Formula.LEFT=function(text,number){return number="undefined"==typeof number?1:number,text.substring(0,number)},idr.workbook.Formula.RIGHT=function(text,number){return number="undefined"==typeof number?1:number,text.substring(text.length-number)},idr.workbook.Formula.LEN=function(text){return text.length},idr.workbook.Formula.LOWER=function(text){return text?text.toLowerCase():text},idr.workbook.Formula.UPPER=function(text){return text?text.toUpperCase():text},idr.workbook.Formula.ABS=function(value){var result=Math.abs(value);if(isNaN(result))throw new Error(idr.workbook.Formula.GENERAL_ERROR);return result},idr.workbook.Formula.ACOS=function(value){var result=Math.acos(value);if(isNaN(result))throw new Error(idr.workbook.Formula.GENERAL_ERROR);return result},idr.workbook.Formula.ASIN=function(value){var result=Math.asin(value);if(isNaN(result))throw new Error(idr.workbook.Formula.GENERAL_ERROR);return result},idr.workbook.Formula.ATAN=function(value){var result=Math.atan(value);if(isNaN(result))throw new Error(idr.workbook.Formula.GENERAL_ERROR);return result},idr.workbook.Formula.ATAN2=function(x,y){var result=Math.atan2(y,x);if(isNaN(result))throw new Error(idr.workbook.Formula.GENERAL_ERROR);return result},idr.workbook.Formula.CEILING=function(value){var result=Math.ceil(value);if(isNaN(result))throw new Error(idr.workbook.Formula.GENERAL_ERROR);return result},idr.workbook.Formula.COS=function(angle){var result=Math.cos(angle);if(isNaN(result))throw new Error(idr.workbook.Formula.GENERAL_ERROR);return result},idr.workbook.Formula.EXP=function(exponent){var result=Math.exp(exponent);if(isNaN(result))throw new Error(idr.workbook.Formula.GENERAL_ERROR);return result},idr.workbook.Formula.FLOOR=function(value){var result=Math.floor(value);if(isNaN(result))throw new Error(idr.workbook.Formula.GENERAL_ERROR);return result},idr.workbook.Formula.LN=function(value){var result=Math.log(value);if(isNaN(result))throw new Error(idr.workbook.Formula.GENERAL_ERROR);return result},idr.workbook.Formula.MOD=function(dividend,divisor){var result=dividend%divisor;if(isNaN(result))throw new Error(idr.workbook.Formula.GENERAL_ERROR);return result},idr.workbook.Formula.POWER=function(number,power){var result=Math.pow(number,power);if(isNaN(result))throw new Error(idr.workbook.Formula.GENERAL_ERROR);return result},idr.workbook.Formula.RAND=function(){return Math.random()},idr.workbook.Formula.ROUND=function(value){var result=Math.round(value);if(isNaN(result))throw new Error(idr.workbook.Formula.GENERAL_ERROR);return result},idr.workbook.Formula.SIN=function(angle){var result=Math.sin(angle);if(isNaN(result))throw new Error(idr.workbook.Formula.GENERAL_ERROR);return result},idr.workbook.Formula.SQRT=function(number){var result=Math.sqrt(number);if(isNaN(result))throw new Error(idr.workbook.Formula.GENERAL_ERROR);return result},idr.workbook.Formula.TAN=function(angle){var result=Math.tan(angle);if(isNaN(result))throw new Error(idr.workbook.Formula.GENERAL_ERROR);return result},idr.workbook.Formula.ADD=function(value1,value2){var result=value1+value2;if(isNaN(result))throw new Error(idr.workbook.Formula.GENERAL_ERROR);return result},idr.workbook.Formula.DIVIDE=function(dividend,divisor){var result=dividend/divisor;if(isNaN(result)||1/0===result)throw new Error(idr.workbook.Formula.GENERAL_ERROR);return result},idr.workbook.Formula.EQ=function(value1,value2){return value1===value2},idr.workbook.Formula.GT=function(value1,value2){return value1>value2},idr.workbook.Formula.GTE=function(value1,value2){return value1>=value2},idr.workbook.Formula.LT=function(value1,value2){return value2>value1},idr.workbook.Formula.LTE=function(value1,value2){return value2>=value1},idr.workbook.Formula.MINUS=function(value1,value2){var result=value1-value2;if(isNaN(result))throw new Error(idr.workbook.Formula.GENERAL_ERROR);return result},idr.workbook.Formula.MULTIPLY=function(value1,value2){var result=value1*value2;if(isNaN(result))throw new Error(idr.workbook.Formula.GENERAL_ERROR);return result},idr.workbook.Formula.NE=function(value1,value2){return value1!=value2},idr.workbook.Formula.TEXT=function(number,format,decimals){if(void 0===number||null===number)return"";var result=number.toString();if(void 0!==format&&null!==format){var numberFormat=new goog.i18n.NumberFormat(format);"number"==typeof decimals&&decimals>=0&&10>=decimals&&(numberFormat.setMaximumFractionDigits(decimals),numberFormat.setMinimumFractionDigits(decimals)),result=numberFormat.format(number),"NaN"===result&&(result=number)}return result},idr.workbook.Formula.NUMBERFORMAT=function(number,decimals){var format="#,##0";return idr.workbook.Formula.TEXT(number,format,"number"==typeof decimals?decimals:2)},idr.workbook.Formula.CURRENCYFORMAT=function(number,decimals){return idr.workbook.Formula.TEXT(number,4,"number"==typeof decimals?decimals:2)},idr.workbook.Formula.DOLLAR=function(number,decimals){return idr.workbook.Formula.CURRENCYFORMAT(number,decimals)},idr.workbook.Formula.PERCENTAGEFORMAT=function(number,decimals){return idr.workbook.Formula.TEXT(number,3,decimals)},idr.workbook.Formula.INDIRECT=function(ref_text){var workbookEngine=null,cell=null;return workbookEngine="object"==typeof window._workbook?window._workbook:idr.core.WorkbookController.instance.getWorkbookEngine(),cell=workbookEngine.getCellFromWorksheet("default",ref_text),null!==cell?cell.Value:""},function(){var target;"undefined"!=typeof window?target=window:"undefined"!=typeof global&&(target=global),"object"==typeof target&&(target.ARGSCONCAT=idr.workbook.Formula.ARGSCONCAT,target.ARGSTOARRAY=idr.workbook.Formula.ARGSTOARRAY,target.AVERAGE=idr.workbook.Formula.AVERAGE,target.CONCATENATE=idr.workbook.Formula.CONCATENATE,target.COUNT=idr.workbook.Formula.COUNT,target.ELEMENTSINRANGE=idr.workbook.Formula.ELEMENTSINRANGE,target.IF=idr.workbook.Formula.IF,target.ISNUMBER=idr.workbook.Formula.ISNUMBER,target.LEFT=idr.workbook.Formula.LEFT,target.LEN=idr.workbook.Formula.LEN,target.LOWER=idr.workbook.Formula.LOWER,target.MAX=idr.workbook.Formula.MAX,target.MIN=idr.workbook.Formula.MIN,target.RIGHT=idr.workbook.Formula.RIGHT,target.SUM=idr.workbook.Formula.SUM,target.UPPER=idr.workbook.Formula.UPPER,target.TEXT=idr.workbook.Formula.TEXT,target.NUMBERFORMAT=idr.workbook.Formula.NUMBERFORMAT,target.CURRENCYFORMAT=idr.workbook.Formula.CURRENCYFORMAT,target.DOLLAR=idr.workbook.Formula.DOLLAR,target.PERCENTAGEFORMAT=idr.workbook.Formula.PERCENTAGEFORMAT,target.ABS=idr.workbook.Formula.ABS,target.ACOS=idr.workbook.Formula.ACOS,target.ASIN=idr.workbook.Formula.ASIN,target.ATAN=idr.workbook.Formula.ATAN,target.ATAN2=idr.workbook.Formula.ATAN2,target.CEILING=idr.workbook.Formula.CEILING,target.COS=idr.workbook.Formula.COS,target.EXP=idr.workbook.Formula.EXP,target.FLOOR=idr.workbook.Formula.FLOOR,target.LN=idr.workbook.Formula.LN,target.MOD=idr.workbook.Formula.MOD,target.POWER=idr.workbook.Formula.POWER,target.RAND=idr.workbook.Formula.RAND,target.ROUND=idr.workbook.Formula.ROUND,target.SIN=idr.workbook.Formula.SIN,target.SQRT=idr.workbook.Formula.SQRT,target.TAN=idr.workbook.Formula.TAN,target.ADD=idr.workbook.Formula.ADD,target.DIVIDE=idr.workbook.Formula.DIVIDE,target.EQ=idr.workbook.Formula.EQ,target.GT=idr.workbook.Formula.GT,target.GTE=idr.workbook.Formula.GTE,target.LT=idr.workbook.Formula.LT,target.LTE=idr.workbook.Formula.LTE,target.MINUS=idr.workbook.Formula.MINUS,target.MULTIPLY=idr.workbook.Formula.MULTIPLY,target.NE=idr.workbook.Formula.NE,target.INDIRECT=idr.workbook.Formula.INDIRECT)}();