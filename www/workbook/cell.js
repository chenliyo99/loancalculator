/**
 * @license Copyright 2013 - 2014 Intel Corporation All Rights Reserved.
 *
 * The source code, information and material ("Material") contained herein is owned by Intel Corporation or its
 * suppliers or licensors, and title to such Material remains with Intel Corporation or its suppliers or
 * licensors. The Material contains proprietary information of Intel or its suppliers and licensors. The
 * Material is protected by worldwide copyright laws and treaty provisions. No part of the Material may be used,
 * copied, reproduced, modified, published, uploaded, posted, transmitted, distributed or disclosed in any way
 * without Intel's prior express written permission. No license under any patent, copyright or other intellectual
 * property rights in the Material is granted to or conferred upon you, either expressly, by implication,
 * inducement, estoppel or otherwise. Any license under such intellectual property rights must be express and
 * approved by Intel in writing.
 *
 * Unless otherwise agreed by Intel in writing, you may not remove or alter this notice or any other notice
 * embedded in Materials by Intel or Intel's suppliers or licensors in any way.
 */
goog.provide("idr.workbook.Cell"),goog.require("idr.workbook.CellStyle"),goog.require("idr.workbook.CellFormat"),idr.workbook.Cell=function(name,formulaText,runtime,parent){this._name=name,this._formulaText=null,this._formula=null,this._value=null,this._runtime=void 0===runtime?null:runtime,this._observers=[],this._dependencies=[],this._parent=void 0===parent?null:parent,this._error=0,this._cellFormat=null,this._cellStyle=null,this._type=idr.workbook.Cell.TYPE_STRING,this._needEvaluate=!0,this._allObserversCache=[],this.FormulaText=formulaText},idr.workbook.Cell.TYPE_NUMBER=0,idr.workbook.Cell.TYPE_STRING=1,idr.workbook.Cell.TYPE_ERROR=-1,Object.defineProperty(idr.workbook.Cell.prototype,"Type",{get:function(){return this._type}}),Object.defineProperty(idr.workbook.Cell.prototype,"Name",{get:function(){return this._name}}),Object.defineProperty(idr.workbook.Cell.prototype,"FormulaText",{get:function(){return this._formulaText},set:function(formulaText){this._formulaText=formulaText,null!==this._runtime&&(this._formulaText=this._runtime.normalizeFormulaText(this._formulaText),this._runtime.cellNeedsToUpdate(this)),this.notifyChangeToParent()}}),Object.defineProperty(idr.workbook.Cell.prototype,"Formula",{get:function(){return this._formula},set:function(formula){this._formula=formula}}),Object.defineProperty(idr.workbook.Cell.prototype,"Value",{get:function(){return this._value},set:function(value){return this._value=value,"function"==typeof value?(this._type=idr.workbook.Cell.TYPE_ERROR,void this.setError(1,idr.workbook.RuntimeBase.ERROR_IN_NAME)):(this._type="string"==typeof value?idr.workbook.Cell.TYPE_STRING:idr.workbook.Cell.TYPE_NUMBER,void this.applyFormat())}}),Object.defineProperty(idr.workbook.Cell.prototype,"Error",{get:function(){return this._error}}),Object.defineProperty(idr.workbook.Cell.prototype,"CellFormat",{get:function(){return this._cellFormat},set:function(value){this._cellFormat=value}}),Object.defineProperty(idr.workbook.Cell.prototype,"CellStyle",{get:function(){return this._cellStyle},set:function(value){this._cellStyle=value}}),Object.defineProperty(idr.workbook.Cell.prototype,"NeedEvaluate",{get:function(){return this._needEvaluate},set:function(value){this._needEvaluate=value}}),idr.workbook.Cell.prototype.hasStyle=function(){return null!==this._cellStyle},idr.workbook.Cell.prototype.hasFormat=function(){return null!==this._cellFormat},idr.workbook.Cell.prototype.getFormatedValue=function(){return this.CellFormat&&this.CellFormat.FormatedValue?this.CellFormat.FormatedValue:this.Value},idr.workbook.Cell.prototype.setError=function(errorCode,errorMsg){this._error=errorCode,this._value=errorMsg},idr.workbook.Cell.prototype.accept=function(visitor){return visitor.visit(this)},idr.workbook.Cell.prototype.addObserver=function(cell){-1===this._observers.indexOf(cell)&&this._observers.push(cell)},idr.workbook.Cell.prototype.removeObserver=function(cell){var index=this._observers.indexOf(cell);index>-1&&this._observers.splice(index,1)},idr.workbook.Cell.prototype.getObservers=function(){return this._observers},idr.workbook.Cell.prototype.getAllObservers=function(){return 0===this._allObserversCache.length&&(this._allObserversCache=this.calculateAllObservers(),this._allObserversCache=this._allObserversCache.filter(function(elem,pos,self){return self.indexOf(elem)===pos})),this._allObserversCache},idr.workbook.Cell.prototype.calculateAllObservers=function(){var observersResult=[];if(0!==this._observers.length)for(var i in this._observers)observersResult=observersResult.concat(this._observers[i].calculateAllObservers()),observersResult=observersResult.concat(this._observers[i]);return observersResult},idr.workbook.Cell.prototype.getDependencies=function(){return this._dependencies},idr.workbook.Cell.prototype.addDependency=function(dependency){-1===this._dependencies.indexOf(dependency)&&(this._dependencies.push(dependency),dependency.addObserver(this))},idr.workbook.Cell.prototype.removeAllDependencies=function(){for(var i in this._dependencies)this._dependencies[i].removeObserver(this);this._dependencies=[],this._allObserversCache=[]},idr.workbook.Cell.prototype.onDependencyValueChanged=function(){null!==this._runtime&&this._runtime.evaluateCell(this),this.notifyChange()},idr.workbook.Cell.prototype.setParentWorksheet=function(worksheet){this._parent=worksheet},idr.workbook.Cell.prototype.getParentWorksheet=function(){return this._parent},idr.workbook.Cell.prototype.clean=function(){this._formulaText="",this._formula=null,this._value=null,this.removeAllDependencies(),this._error=0},idr.workbook.Cell.prototype.notifyChange=function(){for(var i in this._observers)this._observers[i].onDependencyValueChanged()},idr.workbook.Cell.prototype.notifyChangeToParent=function(){if(null!==this._parent){var cells=[];cells.push(this),cells=cells.concat(this.getAllObservers()),this._parent.onCellsChanged(cells)}},idr.workbook.Cell.prototype.setAlignment=function(alignment){this.hasStyle()||(this.CellStyle=new idr.workbook.CellStyle),this.CellStyle.TextAlign=alignment},idr.workbook.Cell.prototype.applyFormat=function(){this.CellFormat&&this.CellFormat.format()},idr.workbook.Cell.prototype.applyStyle=function(markup){this.CellStyle&&this.CellStyle.format(markup)},idr.workbook.Cell.getState=function(key,cell){return idr.workbook.Cell.STATES[key](cell)},idr.workbook.Cell.getTextState=function(cell){return null!==cell.CellFormat?cell.CellFormat.isText():!1},idr.workbook.Cell.getCurrencyState=function(cell){return null!==cell.CellFormat?cell.CellFormat.isCurrency():!1},idr.workbook.Cell.getPercentageState=function(cell){return null!==cell.CellFormat?cell.CellFormat.isPercentage():!1},idr.workbook.Cell.getNumberState=function(cell){return null!==cell.CellFormat?cell.CellFormat.isNumber():!1},idr.workbook.Cell.getDateState=function(cell){var dateFormat="",format=cell.CellFormat;return null!==format&&format.isDate()&&(dateFormat=format.FormatExpression),dateFormat},idr.workbook.Cell.getBoldState=function(cell){return null!==cell.CellStyle?cell.CellStyle.getFontWeightBold():!1},idr.workbook.Cell.getItalicState=function(cell){return null!==cell.CellStyle?cell.CellStyle.getFontStyleItalic():!1},idr.workbook.Cell.getUnderlineState=function(cell){return null!==cell.CellStyle?cell.CellStyle.getFontStyleUnderline():!1},idr.workbook.Cell.getColorState=function(cell){return null!==cell.CellStyle?cell.CellStyle.FontColor:"black"},idr.workbook.Cell.getBackgroundState=function(cell){return null!==cell.CellStyle?cell.CellStyle.BackgroundColor:"black"},idr.workbook.Cell.getFontFamily=function(cell){return null!==cell.CellStyle?cell.CellStyle.FontFamily:""},idr.workbook.Cell.getFontSize=function(cell){return null!==cell.CellStyle?cell.CellStyle.FontSize:""},idr.workbook.Cell.getAlignmentLeftState=function(cell){return null!==cell.CellStyle?"left"===cell.CellStyle.TextAlign:!1},idr.workbook.Cell.getAlignmentCenterState=function(cell){return null!==cell.CellStyle?"center"===cell.CellStyle.TextAlign:!1},idr.workbook.Cell.getAlignmentRightState=function(cell){return null!==cell.CellStyle?"right"===cell.CellStyle.TextAlign:!1},idr.workbook.Cell.STATES={"FORMAT.TEXT":idr.workbook.Cell.getTextState,"FORMAT.CURRENCY":idr.workbook.Cell.getCurrencyState,"FORMAT.PERCENTAGE":idr.workbook.Cell.getPercentageState,"FORMAT.NUMBER":idr.workbook.Cell.getNumberState,"FORMAT.DATE":idr.workbook.Cell.getDateState,"CONTENT.BOLD":idr.workbook.Cell.getBoldState,"CONTENT.ITALIC":idr.workbook.Cell.getItalicState,"CONTENT.UNDERLINE":idr.workbook.Cell.getUnderlineState,"CONTENT.FONTFAMILY":idr.workbook.Cell.getFontFamily,"CONTENT.FONTSIZE":idr.workbook.Cell.getFontSize,"CELL.COLOR":idr.workbook.Cell.getColorState,"BACKGROUND.COLOR":idr.workbook.Cell.getBackgroundState,"ALIGNMENT.LEFT":idr.workbook.Cell.getAlignmentLeftState,"ALIGNMENT.CENTER":idr.workbook.Cell.getAlignmentCenterState,"ALIGNMENT.RIGHT":idr.workbook.Cell.getAlignmentRightState},idr.workbook.Cell.prototype.toJson=function(){var cellStyleJson=this.CellStyle?this.CellStyle.toJson():null,cellFormatJson=this.CellFormat?this.CellFormat.toJson():null,cellJson={Name:this.Name,FormulaText:this.FormulaText,Value:this.Value,CellStyle:cellStyleJson,CellFormat:cellFormatJson};return cellJson},idr.workbook.Cell.prototype.loadFromJson=function(json){this.loadCellStyleFromJson(json.CellStyle),this.loadCellFormatFromJson(json.CellFormat),this.FormulaText=json.FormulaText?json.FormulaText:this.FormulaText,this.Formula=json.Formula?json.Formula:this.Formula,this.Value=json.Value?json.Value:this.Value},idr.workbook.Cell.prototype.loadCellFormatFromJson=function(jsonObject){null!==jsonObject&&void 0!==jsonObject&&(this._cellFormat=new idr.workbook.CellFormat(this),this.CellFormat.loadFromJson(jsonObject))},idr.workbook.Cell.prototype.loadCellStyleFromJson=function(jsonObject){null!==jsonObject&&void 0!==jsonObject&&(this.CellStyle=new idr.workbook.CellStyle,this.CellStyle.loadFromJson(jsonObject))};