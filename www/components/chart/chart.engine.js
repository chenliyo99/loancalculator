/**
 * @license Copyright 2013 - 2014 Intel Corporation All Rights Reserved.
 *
 * The source code, information and material ("Material") contained herein is owned by Intel Corporation or its
 * suppliers or licensors, and title to such Material remains with Intel Corporation or its suppliers or
 * licensors. The Material contains proprietary information of Intel or its suppliers and licensors. The
 * Material is protected by worldwide copyright laws and treaty provisions. No part of the Material may be used,
 * copied, reproduced, modified, published, uploaded, posted, transmitted, distributed or disclosed in any way
 * without Intel's prior express written permission. No license under any patent, copyright or other intellectual
 * property rights in the Material is granted to or conferred upon you, either expressly, by implication,
 * inducement, estoppel or otherwise. Any license under such intellectual property rights must be express and
 * approved by Intel in writing.
 *
 * Unless otherwise agreed by Intel in writing, you may not remove or alter this notice or any other notice
 * embedded in Materials by Intel or Intel's suppliers or licensors in any way.
 */
goog.require("idr.components.ChartTypeFactory"),goog.require("idr.components.BaseChart"),goog.require("goog.structs.Map"),goog.require("goog.i18n.NumberFormat"),goog.provide("idr.components.ChartEngine"),idr.components.ChartEngine=function(parent,baseView,chartType,showLegend,showAxis){this._parent=parent,this._baseView=baseView,this._chartType=chartType||"columns",this._showLegend=showLegend,this._showAxis=showAxis,this._chartTemplate=null,this._ranges={},this._chartData=null},idr.components.ChartEngine.prototype.initialize=function(){this.createChart()},idr.components.ChartEngine.prototype.createChart=function(){var options={selector:"#"+$(this._baseView).attr("id"),showLegend:this._showLegend,showAxis:this._showAxis};this._chartTemplate=idr.components.ChartTypeFactory.createTemplate(this._chartType,options)},idr.components.ChartEngine.prototype.addOrUpdateRanges=function(rawData){if(rawData instanceof Array){var ranges=this.rawDataToRanges(rawData);this.setRanges(ranges)}else{var value=this.rawDataToValue(rawData);this.addOrUpdate(value)}},idr.components.ChartEngine.prototype.rawDataToRanges=function(rawData){for(var ranges=[],i=(new goog.i18n.NumberFormat("$#,##0.00"),0),size=rawData.length;size>i;i++)for(var rawItem=rawData[i],j=0,len=rawItem.length;len>j;j++){var item=rawItem[j],rangeItem=this.rawDataToValue(item);ranges.push(rangeItem)}return ranges},idr.components.ChartEngine.prototype.rawDataToValue=function(rawData){var rangeItem={parentKey:rawData.field,key:rawData.item,value:idr.components.ChartEngine.parseNumber(rawData.value)};return rangeItem},idr.components.ChartEngine.prototype.setRanges=function(ranges){this.deleteAllRanges();for(var i=0,len=ranges.length;len>i;i++){var rangeItem=ranges[i];this.addRangeItem(rangeItem)}this.notifyDataRangesChange()},idr.components.ChartEngine.prototype.addOrUpdate=function(rangeItem){if(null!==rangeItem&&void 0!==rangeItem){var range=this._ranges[rangeItem.parentKey];void 0!==range&&range.containsKey(rangeItem.key)&&(this.updateRangeItem(rangeItem),this.notifyItemValueChange(rangeItem))}},idr.components.ChartEngine.prototype.addRangeItem=function(item){var range=this._ranges[item.parentKey];void 0===range&&(range=new goog.structs.Map,this._ranges[item.parentKey]=range),range.set(item.key,item)},idr.components.ChartEngine.prototype.updateRangeItem=function(rangeItem){var range=this._ranges[rangeItem.parentKey],item=range.get(rangeItem.key);item.value=rangeItem.value},idr.components.ChartEngine.prototype.deleteAllRanges=function(){this._ranges={}},idr.components.ChartEngine.prototype.notifyDataRangesChange=function(){this._chartTemplate.render(this._ranges)},idr.components.ChartEngine.prototype.notifyItemValueChange=function(rangeItem){this._chartTemplate.updateSerieRender(rangeItem)},idr.components.ChartEngine.prototype.updateTemplate=function(chartType){this._chartType=chartType,this.createChart(),this._chartTemplate.render(this._ranges)},idr.components.ChartEngine.prototype.resize=function(){this._baseView.css("max-height",""),this._chartTemplate.resize()},idr.components.ChartEngine.prototype.showAxisTitle=function(isEnabled){null!==this._chartTemplate&&(this._showAxis=isEnabled,this._chartTemplate.showAxisTitle(isEnabled))},idr.components.ChartEngine.prototype.showLegendTitle=function(isEnabled){null!==this._chartTemplate&&(this._showLegend=isEnabled,this._chartTemplate.showLegendTitle(this._showLegend))},idr.components.ChartEngine.parseNumber=function(value){if(void 0===value||null===value)return value;var numberFormat=new goog.i18n.NumberFormat("$#,##0.00"),result=numberFormat.parse(value.toString());return isNaN(result)&&(result=value),result};