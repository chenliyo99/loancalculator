/**
 * @license Copyright 2013 - 2014 Intel Corporation All Rights Reserved.
 *
 * The source code, information and material ("Material") contained herein is owned by Intel Corporation or its
 * suppliers or licensors, and title to such Material remains with Intel Corporation or its suppliers or
 * licensors. The Material contains proprietary information of Intel or its suppliers and licensors. The
 * Material is protected by worldwide copyright laws and treaty provisions. No part of the Material may be used,
 * copied, reproduced, modified, published, uploaded, posted, transmitted, distributed or disclosed in any way
 * without Intel's prior express written permission. No license under any patent, copyright or other intellectual
 * property rights in the Material is granted to or conferred upon you, either expressly, by implication,
 * inducement, estoppel or otherwise. Any license under such intellectual property rights must be express and
 * approved by Intel in writing.
 *
 * Unless otherwise agreed by Intel in writing, you may not remove or alter this notice or any other notice
 * embedded in Materials by Intel or Intel's suppliers or licensors in any way.
 */
goog.provide("idr.runtime.InputField"),goog.require("idr.runtime.ComponentRuntime"),goog.require("idr.components.InputFieldBase"),idr.runtime.InputField=function(id,data,parent){idr.components.InputFieldBase.call(this,id,data,parent),this.initializeRuntime(data),this.loadCss("inputfield","inputfield.runtime.css"),this._view=null,this._labelMarkup=null,this._inputMarkup=null,this._labelToggleMarkup=null,this._inputId=id+"_inputfield",this._labelToggleId=id+"_labelToggle";var that=this;this._changeCallback=function(){if(that.inputType()!==idr.components.InputFieldBase.INPUT_TYPE.slider){var value="";value="checkbox"===$(this).attr("type")?$(this).prop("checked").toString():$(this).val(),that.acceptValue(value)}},this.addPropertyChangedHandler("label",function(){this._labelMarkup.text(this.label())}),this.addPropertyChangedHandler("inputText",function(){this.onChangeInputText()}),this.addPropertyChangedHandler("inputType",function(){this.onChangeInputType()}),this.addPropertyChangedHandler("inputMinValue",function(){this.onChangeInputMinValue()}),this.addPropertyChangedHandler("inputMaxValue",function(){this.onChangeInputMaxValue()})},goog.inherits(idr.runtime.InputField,idr.components.InputFieldBase),goog.mixin(idr.runtime.InputField.prototype,idr.runtime.ComponentRuntime.prototype),idr.runtime.InputField.prototype.show=function(){},idr.runtime.InputField.prototype.render=function(){var that=this;null===this._view&&(this._view=$('<div class="idr-input-field"></div>'),this._labelMarkup=$("<label></label>"),this._labelMarkup.attr("for",this._inputId),this._labelMarkup.text(this.label()),this._inputMarkup=$('<input type="text">'),this._inputMarkup.attr("id",this._inputId),this._labelToggleMarkup=$('<label data-on="On" data-off="Off"><span></span></label>'),this._labelToggleMarkup.attr("id",this._labelToggleId),this._labelToggleMarkup.attr("for",this._inputId),this._rangeValue=null,this._inputMarkup.on("blur",function(){that.acceptValue($(this).val())}),this._inputMarkup.on("keyup",function(event){13===event.keyCode?that.acceptValue($(this).val()):27===event.keyCode}),this._inputMarkup.on("change",this._changeCallback),this._view.append(this._labelMarkup),this._view.append(this._inputMarkup),this.onChangeInputType(),this.onChangeInputText(),setInterval(function(){if(that.inputType()===idr.components.InputFieldBase.INPUT_TYPE.slider){var currentValue=$(that._inputMarkup).val();that._rangeValue!==currentValue&&(that.acceptValue(currentValue),that._rangeValue=currentValue)}},100))},idr.runtime.InputField.prototype.view=function(){return null===this._view&&this.render(),this._view},idr.runtime.InputField.prototype.componentDeleted=function(){idr.components.InputFieldBase.prototype.componentDeleted.call(this)},idr.runtime.InputField.prototype.onChildrenAdded=function(child){var childMarkup=child.view();this._contentDiv.append(childMarkup)},idr.runtime.InputField.prototype.onChildrenRemoved=function(){},idr.runtime.InputField.prototype.acceptValue=function(value){var finalValue=value;(this._inputType===idr.components.InputFieldBase.INPUT_TYPE.number||this._inputType===idr.components.InputFieldBase.INPUT_TYPE.currency||this._inputType===idr.components.InputFieldBase.INPUT_TYPE.slider)&&(isNaN(value)||(finalValue=parseFloat(value))),this.Binder.setWorkbookValue("default",(this.inputTextFormula()+"").trim(),finalValue)},idr.runtime.InputField.prototype.onChangeInputText=function(){"checkbox"===this._inputMarkup.attr("type")?this._inputMarkup.prop("checked",this.inputText()===idr.components.InputFieldBase.STRING_TRUE):this._inputMarkup.val(this.inputText())},idr.runtime.InputField.prototype.onChangeInputType=function(){if(this._inputMarkup.removeAttr("min"),this._inputMarkup.removeAttr("max"),this._inputMarkup.removeClass("toggle"),this._view.find("#"+this._labelToggleId).remove(),this.inputType()===idr.components.InputFieldBase.INPUT_TYPE.text&&this._inputMarkup.attr("type","text"),this.inputType()===idr.components.InputFieldBase.INPUT_TYPE.number&&this._inputMarkup.attr("type","number"),this.inputType()===idr.components.InputFieldBase.INPUT_TYPE.slider&&(this._inputMarkup.attr("type","range"),this._inputMarkup.attr("min",this.inputMinValue()),this._inputMarkup.attr("max",this.inputMaxValue())),this.inputType()===idr.components.InputFieldBase.INPUT_TYPE.flipswitch){this._inputMarkup.attr("type","checkbox"),this._inputMarkup.addClass("toggle");var inputMarkup=this._view.find("#"+this._inputId);inputMarkup.after(this._labelToggleMarkup)}},idr.runtime.InputField.prototype.onChangeInputMinValue=function(){this._inputMarkup.attr("min",this.inputMinValue())},idr.runtime.InputField.prototype.onChangeInputMaxValue=function(){this._inputMarkup.attr("max",this.inputMaxValue())};