/**
 * @license Copyright 2013 - 2014 Intel Corporation All Rights Reserved.
 *
 * The source code, information and material ("Material") contained herein is owned by Intel Corporation or its
 * suppliers or licensors, and title to such Material remains with Intel Corporation or its suppliers or
 * licensors. The Material contains proprietary information of Intel or its suppliers and licensors. The
 * Material is protected by worldwide copyright laws and treaty provisions. No part of the Material may be used,
 * copied, reproduced, modified, published, uploaded, posted, transmitted, distributed or disclosed in any way
 * without Intel's prior express written permission. No license under any patent, copyright or other intellectual
 * property rights in the Material is granted to or conferred upon you, either expressly, by implication,
 * inducement, estoppel or otherwise. Any license under such intellectual property rights must be express and
 * approved by Intel in writing.
 *
 * Unless otherwise agreed by Intel in writing, you may not remove or alter this notice or any other notice
 * embedded in Materials by Intel or Intel's suppliers or licensors in any way.
 */
goog.provide("idr.components.MediaCore"),goog.require("goog.structs.Map"),idr.components.MediaCore=function(mediaBase,options){this._mediaBase=mediaBase,this._currentMediaItem=0,this._currentMedia=null,this._mediaViewReady=!1,this._mediaGalleryItemsMap=new goog.structs.Map,this._currentMediaChangeCallback=null,this._mediaGalleryChangeCallback=null,this._itemSelectedCallback=null,this._view=null,this._contentMarkup=null,this._maxGridItemsToShow=null,options&&(this._maxGridItemsToShow="undefined"!==options.maxGridItemsToShow?options.maxGridItemsToShow:null)},idr.components.MediaCore.prototype.items=function(){return this._mediaGalleryItemsMap.getValues()},idr.components.MediaCore.prototype.setItems=function(data){this._mediaGalleryItemsMap.clear();for(var i=0;i<data.length;i++)this._mediaGalleryItemsMap.set(data[i].Id,data[i]);null!==this._mediaGalleryChangeCallback&&this._mediaGalleryChangeCallback({action:"SET",media:null})},idr.components.MediaCore.prototype.setItem=function(item){this._mediaGalleryItemsMap.clear(),this._mediaGalleryItemsMap.set(item.Id,item),null!==this._mediaGalleryChangeCallback&&this._mediaGalleryChangeCallback({action:"SET",media:null})},idr.components.MediaCore.prototype.getItemById=function(id){return this._mediaGalleryItemsMap.get(id)},idr.components.MediaCore.prototype.add=function(type,item){return this._mediaGalleryItemsMap.set(item.Id,item),null!==this._mediaGalleryChangeCallback&&this._mediaGalleryChangeCallback({action:"ADD",media:item}),item},idr.components.MediaCore.prototype.removeMedia=function(type,item){this._mediaGalleryChangeCallback({action:"REMOVE",media:item})},idr.components.MediaCore.prototype.clear=function(){this._currentMediaItem=0,this._mediaGalleryItemsMap.clear(),this._mediaGalleryChangeCallback&&this._mediaGalleryChangeCallback({action:"CLEAR",media:null})},idr.components.MediaCore.prototype.goTo=function(pos){this._currentMedia=null,pos=parseInt(pos,10);var mediaGalleryItems=this._mediaGalleryItemsMap.getValues();return pos>=0&&pos<mediaGalleryItems.length&&(this._currentMediaItem=pos,this._currentMedia=mediaGalleryItems[this._currentMediaItem],null!==this._currentMediaChangeCallback&&this._currentMediaChangeCallback(this._currentMediaItem,this._currentMedia)),this._currentMedia},idr.components.MediaCore.prototype.getCurrentMedia=function(){return this._mediaGalleryItemsMap.getValues()[this._currentMediaItem]},idr.components.MediaCore.prototype.setCurrentMediaChangeCallback=function(callback){"function"==typeof callback&&(this._currentMediaChangeCallback=callback)},idr.components.MediaCore.prototype.unsetCurrentMediaChangeCallback=function(){this._currentMediaChangeCallback=null},idr.components.MediaCore.prototype.setMediaGalleryChangeCallback=function(callback){"function"==typeof callback&&(this._mediaGalleryChangeCallback=callback)},idr.components.MediaCore.prototype.unsetMediaGalleryChangeCallback=function(){this._mediaGalleryChangeCallback=null},idr.components.MediaCore.prototype.setItemSelectedCallback=function(callback){"function"==typeof callback&&(this._itemSelectedCallback=callback)},idr.components.MediaCore.prototype.unsetItemSelectedCallback=function(){this._itemSelectedCallback=null},idr.components.MediaCore.prototype.needsConfiguration=function(){var dataRange=this._mediaBase.mediaDataRange(),dataSource=this._mediaBase.mediaData();return null===dataSource||""===dataSource.trim()||null===dataRange||0===dataRange.length},idr.components.MediaCore.prototype.setComponentConfigured=function(){this._mediaViewReady===!1&&(this.updateView(),this._mediaViewReady=!0)},idr.components.MediaCore.prototype.view=function(){return null===this._view&&(this._view=$('<div class="idr-media-gallery-container"></div>'),this._contentMarkup=$('<div class="idr-media-gallery-content"></div>'),this._view.append(this._contentMarkup),this.updateView()),this._view},idr.components.MediaCore.prototype.updateView=function(){null!==this._contentMarkup&&(this.needsConfiguration()?this.setUpNeedsConfigurationMarkup():this.updateContainerMarkup())},idr.components.MediaCore.prototype.setUpNeedsConfigurationMarkup=function(){this._mediaViewReady=!1,this._contentMarkup.empty(),this._contentMarkup.append(this.getComponentNeedsConfigurationMarkup())},idr.components.MediaCore.prototype.updateContainerMarkup=function(){null!==this._view&&this._mediaViewReady&&this.updateContentMarkup()},idr.components.MediaCore.prototype.updateContentMarkup=function(){if(null!==this._contentMarkup){var that=this,items=this.items();if(this._contentMarkup.empty(),this._contentMarkup.removeClass(),this._mediaBase.galleryType()===idr.components.MediaBase.GALLERY_TYPE.grid){this._contentMarkup.addClass("idr-grid"),this.updateImageStretchMode();for(var i=0;i<items.length&&(null===this._maxGridItemsToShow||i<this._maxGridItemsToShow);i++){var itemMarkup=items[i].view();this._contentMarkup.append(itemMarkup)}}else if(this._contentMarkup.addClass("idr-single"),this.updateImageStretchMode(),0!==items.length){var item=items[0].view();this._contentMarkup.append(item)}this.updateGridPadding(),this.updatePadding(),this._contentMarkup.off("click"),this._contentMarkup.on("click",".idr-item",function(){that._itemSelectedCallback&&that._itemSelectedCallback($(this).attr("id"))})}},idr.components.MediaCore.prototype.updateItemMarkup=function(item){var currentItemMarkup=this._contentMarkup.find(".idr-item .idr-image");currentItemMarkup&&(currentItemMarkup[0].src=item.Src)},idr.components.MediaCore.prototype.remove=function(){this.clear(),this._view.remove(),this._view=null},idr.components.MediaCore.prototype.updateGalleryType=function(){this._currentMediaItem=0,this.updateContainerMarkup()},idr.components.MediaCore.prototype.updateMediaType=function(){this.clear(),this.updateContainerMarkup()},idr.components.MediaCore.prototype.updateImageStretchMode=function(){null!==this._view&&(this._view.removeClass(idr.components.MediaBase.IMG_STRETCH_MODE.fit),this._view.removeClass(idr.components.MediaBase.IMG_STRETCH_MODE.stretch),this._view.addClass(this._mediaBase.imageStretchMode()))},idr.components.MediaCore.prototype.updatePadding=function(){null!==this._view&&(this._view.removeClass(function(index,css){return(css.match(/\bidr-media-gallery-padding-\S+/g)||[]).join(" ")}),this._view.addClass(this._mediaBase.padding()))},idr.components.MediaCore.prototype.updateGridPadding=function(){null!==this._view&&(this._view.removeClass(function(index,css){return(css.match(/\bpadding-\S+/g)||[]).join(" ")}),this._view.addClass(this._mediaBase.gridPadding()))};