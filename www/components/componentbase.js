/**
 * @license Copyright 2013 - 2014 Intel Corporation All Rights Reserved.
 *
 * The source code, information and material ("Material") contained herein is owned by Intel Corporation or its
 * suppliers or licensors, and title to such Material remains with Intel Corporation or its suppliers or
 * licensors. The Material contains proprietary information of Intel or its suppliers and licensors. The
 * Material is protected by worldwide copyright laws and treaty provisions. No part of the Material may be used,
 * copied, reproduced, modified, published, uploaded, posted, transmitted, distributed or disclosed in any way
 * without Intel's prior express written permission. No license under any patent, copyright or other intellectual
 * property rights in the Material is granted to or conferred upon you, either expressly, by implication,
 * inducement, estoppel or otherwise. Any license under such intellectual property rights must be express and
 * approved by Intel in writing.
 *
 * Unless otherwise agreed by Intel in writing, you may not remove or alter this notice or any other notice
 * embedded in Materials by Intel or Intel's suppliers or licensors in any way.
 */
goog.provide("idr.components.ComponentBase"),goog.require("idr.debug"),idr.components.ComponentBase=function(instanceId,data,parent){this._id=instanceId,this._parent=parent,this._children=[],this._eventsMap={},this._actionsMap={},void 0!==data&&null!==data&&("object"==typeof data.eventsMap&&(this._eventsMap=data.eventsMap),"object"==typeof data.actionsMap&&(this._actionsMap=data.actionsMap))},Object.defineProperty(idr.components.ComponentBase.prototype,"Id",{get:function(){return this._id}}),Object.defineProperty(idr.components.ComponentBase.prototype,"Parent",{get:function(){return this._parent}}),Object.defineProperty(idr.components.ComponentBase.prototype,"Children",{get:function(){return this._children}}),idr.components.ComponentBase.prototype.hasChildrens=function(){return 0!==this._children.length},idr.components.ComponentBase.prototype.addChild=function(child,sectionName){child._parent=this,this._children.push(child),this.onChildrenAdded(child,sectionName)},idr.components.ComponentBase.prototype.removeChild=function(child){var index=this._children.indexOf(child);index>-1&&(this._children.splice(index,1),this.onChildrenRemoved(child))},idr.components.ComponentBase.prototype.reorderChildrens=function(childId,newIndex){var childs=null,oldIndex=-1;this._children.some(function(item,index){return item.Id===childId?oldIndex=index:!1}),-1!==oldIndex&&(childs=this._children.splice(oldIndex,1),this._children.splice(newIndex,0,childs[0]),this.onChildrenReordered(childs[0].Id,newIndex))},idr.components.ComponentBase.prototype.onChildrenAdded=function(){},idr.components.ComponentBase.prototype.onChildrenRemoved=function(){},idr.components.ComponentBase.prototype.onChildrenReordered=function(){},idr.components.ComponentBase.prototype.addPropertyChangedHandler=function(propertyName,callback){$(this).on("change."+propertyName,callback)},idr.components.ComponentBase.prototype.removePropertyChangedHandler=function(propertyName,callback){$(this).off("change."+propertyName,callback)},idr.components.ComponentBase.prototype.triggerPropertyChanged=function(propertyName){$(this).trigger("change."+propertyName)},idr.components.ComponentBase.prototype.trigger=function(eventName,extraParameters){$(this).trigger(eventName,extraParameters)},idr.components.ComponentBase.prototype.getTypeName=function(){throw"Function 'getTypeName' not implemented."},idr.components.ComponentBase.keyForEventAction=function(sourceEventKey,targetActionKey,targetInstance){var targetId=targetInstance.Id;return sourceEventKey=sourceEventKey.toUpperCase(),targetActionKey=targetActionKey.toUpperCase(),sourceEventKey+"."+targetId+"."+targetActionKey},idr.components.ComponentBase.prototype.connectEventToAction=function(sourceEventKey,targetActionKey,targetInstance){var key=idr.components.ComponentBase.keyForEventAction(sourceEventKey,targetActionKey,targetInstance);this._eventsMap[key]={event:sourceEventKey,action:targetActionKey,targetId:targetInstance.Id,target:targetInstance};var actions=this._actionsMap[sourceEventKey];void 0===actions&&(actions=this._actionsMap[sourceEventKey]=[]),actions.push(key)},idr.components.ComponentBase.prototype.removeEventToAction=function(sourceEventKey,targetActionKey,targetInstance){var actions,index,key=idr.components.ComponentBase.keyForEventAction(sourceEventKey,targetActionKey,targetInstance);void 0!==this._eventsMap[key]&&delete this._eventsMap[key],actions=this._actionsMap[sourceEventKey],void 0!==actions&&(index=actions.indexOf(key),index>-1&&actions.splice(actions.indexOf(key),1))},idr.components.ComponentBase.prototype.fireEvent=function(eventKey){var that=this;setTimeout(function(){var i,actionKey,actionData,actions=that._actionsMap[eventKey];if(actions instanceof Array)for(i=0;i<actions.length;i++)actionKey=actions[i],actionData=that._eventsMap[actionKey],actionData instanceof Object&&that.dispatchAction(actionData)},0)},idr.components.ComponentBase.prototype.dispatchAction=function(actionData){var targetInstance=actionData.target;(void 0===targetInstance||null===targetInstance)&&(targetInstance=idr.components.FindInstance(actionData.targetId),actionData.target=targetInstance,null===targetInstance&&idr.debug.log('Action not dispatched. Cannot find instance "'+actionData.targetId+'".'));var targetActionKey=actionData.action,actionName=targetActionKey.toLowerCase();try{targetInstance[actionName]()}catch(e){idr.debug.log("error while dispatching action: "+e.toString())}},idr.components.FindInstance=function(){throw'Function "FindInstance" not implemented.'},idr.components.ComponentBase.prototype.stringify=function(){return JSON.stringify(this.rawData())},idr.components.ComponentBase.prototype.rawData=function(){var instance={instanceType:this.getTypeName(),instanceId:this.Id,parentId:null!==this._parent?this._parent.Id:null,data:null,metadata:null};return instance.data=this.rawObject(),instance.metadata=this.rawMetadata(),instance},idr.components.ComponentBase.prototype.eventsMap=function(){var eventsMapclone=$.extend({},this._eventsMap);for(var item in eventsMapclone)eventsMapclone[item].target=void 0;return eventsMapclone},idr.components.ComponentBase.prototype.eventsMapList=function(){var item,eventsMapclone=this.eventsMap(),list=[];for(item in eventsMapclone)item=eventsMapclone[item],delete item.target,list.push(item);return list},idr.components.ComponentBase.prototype.rawObject=function(){var eventsMapclone=this.eventsMap(),actionsMapclone=$.extend({},this._actionsMap);return{eventsMap:eventsMapclone,actionsMap:actionsMapclone}},idr.components.ComponentBase.prototype.rawMetadata=function(){return null},idr.components.ComponentBase.parse=function(componentJson,storyboardEditor){var data;try{data=JSON.parse(componentJson)}catch(e){data=componentJson}return idr.components.ComponentBase.loadFromRawData(data,storyboardEditor)},idr.components.ComponentBase.loadFromRawData=function(data,storyboardEditor){var instanceType=data.instanceType,instanceId=data.instanceId,instanceData=data.data,parentId=data.parentId,parentInstance=null;null!==parentId&&(parentInstance=idr.components.FindInstance(parentId));var newInstance=null;return newInstance=void 0!==storyboardEditor?new idr.storyboard[instanceType+"Editor"](instanceId,instanceData,storyboardEditor,parentInstance):new idr.runtime[instanceType](instanceId,instanceData,parentInstance),null!==newInstance&&null!==parentInstance&&void 0!==parentInstance&&parentInstance.addChild(newInstance),newInstance},Object.defineProperty(idr.components.ComponentBase.prototype,"Binder",{get:function(){return idr.components.Component.Binder}}),idr.components.ComponentBase.prototype.componentDeleted=function(){null!==this._parent&&(this._parent.removeChild(this),this._parent=null),this._eventsMap={},this._actionsMap={}},idr.components.ComponentBase.prototype.parentComponentLoaded=function(){},idr.components.ComponentBase.prototype.booleanValueOf=function(value){return value===!0||value===!1?value:"true"===value};