/**
 * @license Copyright 2013 - 2014 Intel Corporation All Rights Reserved.
 *
 * The source code, information and material ("Material") contained herein is owned by Intel Corporation or its
 * suppliers or licensors, and title to such Material remains with Intel Corporation or its suppliers or
 * licensors. The Material contains proprietary information of Intel or its suppliers and licensors. The
 * Material is protected by worldwide copyright laws and treaty provisions. No part of the Material may be used,
 * copied, reproduced, modified, published, uploaded, posted, transmitted, distributed or disclosed in any way
 * without Intel's prior express written permission. No license under any patent, copyright or other intellectual
 * property rights in the Material is granted to or conferred upon you, either expressly, by implication,
 * inducement, estoppel or otherwise. Any license under such intellectual property rights must be express and
 * approved by Intel in writing.
 *
 * Unless otherwise agreed by Intel in writing, you may not remove or alter this notice or any other notice
 * embedded in Materials by Intel or Intel's suppliers or licensors in any way.
 */
goog.provide("idr.runtime.LivePreview"),goog.require("idr.debug"),idr.runtime.LivePreview=function(editor){this._editor=editor,this._view=null,this._window=null,this._onreadyCallback=null,this._sharedWorkbook=!1},idr.runtime.LivePreview.prototype.isUsingSharedWorkbook=function(){return this._sharedWorkbook},idr.runtime.LivePreview.prototype.initialize=function(onreadyCallback){this._onreadyCallback=onreadyCallback},idr.runtime.LivePreview.prototype.setSharedWorkbook=function(workbook){this._window&&"function"==typeof this._window.__livePreview_setSharedWorkbook&&(this._sharedWorkbook=!0,this._window.__livePreview_setSharedWorkbook(workbook))},idr.runtime.LivePreview.prototype.view=function(){if(null===this._view){var livepreviewLocation;livepreviewLocation=window.location.origin+"/livepreview.html",this._view=$('<div id="livepreview-main"><img src="../assets/img/device_frame-razri.png" draggable="false"/><iframe src="'+livepreviewLocation+'"></iframe></div>');var that=this;this._view.find("iframe").load(function(){idr.debug.log("Live preview created"),that._onreadyCallback instanceof Function&&that._onreadyCallback()})}return this._view},idr.runtime.LivePreview.prototype.reset=function(){this._window=null},idr.runtime.LivePreview.prototype.connectWindow=function(newWindow){idr.debug.log("Live Preview Connected"),this._window=newWindow,this._onreadyCallback instanceof Function&&this._onreadyCallback()},idr.runtime.LivePreview.prototype.viewAddedToDOM=function(){void 0===window.top.xdk&&this.connectWindow(this._view.find("iframe")[0].contentWindow)},idr.runtime.LivePreview.prototype.pushStoryboardState=function(programData){this._window&&this._window.__pushStoryboardStateToRuntime(JSON.stringify(programData))},idr.runtime.LivePreview.prototype.pushFromStoryboard=function(interactionData){if(null===this._window)return void idr.debug.log("LIVEPREVIEW: warning iframe not yet initialized changes in editor lost.");if("CREATE"===interactionData.type)this._window.__livePreview_createObject(interactionData.data);else if("PROPERTY_CHANGE"===interactionData.type)this._window.__livePreview_propertyChange(interactionData.data);else if("EVENT_CONNECTED"===interactionData.type)this._window.__livePreview_eventConnected(interactionData.data);else if("DELETE"===interactionData.type)this._window.__livePreview_deleteObject(interactionData.data);else if("UPDATE_REORDER"===interactionData.type)this._window.__livePreview_updateObjects(interactionData.data);else if("CELLS_CHANGE"===interactionData.type){var worksheet=interactionData.worksheet,changes=interactionData.data;for(var item in changes)this._window._workbook.setCellToWorksheet(worksheet,changes[item].cellName,changes[item].cellFormula)}else"BINDER_LOAD"===interactionData.type?this._window.__livePreview_loadBinder(interactionData.data):"DELETE_CONNECTION"===interactionData.type?this._window.__livePreview_connectionDeleted(interactionData.data):"START_PAGE_CHANGED"===interactionData.type?this._window.__livePreview_startPageChanged(interactionData.data):idr.debug.log('LivePreview Warning: unrecognized message from storyboard "'+interactionData.type+'".')},idr.runtime.LivePreview.prototype.receiveAction=function(){},idr.runtime.LivePreview.prototype.undoHistoryRequested=function(){},idr.runtime.LivePreview.prototype.redoHistoryRequested=function(){},idr.runtime.LivePreview.prototype.hookToViewEvent=function(){},idr.runtime.LivePreview.prototype.baseView=function(){};